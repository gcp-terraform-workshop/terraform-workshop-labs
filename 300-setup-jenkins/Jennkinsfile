pipeline {
  agent {
    docker {
      image 'hashicorp/terraform:light'
      args '--entrypoint='
    }
  }
  stages {

    stage('Clone repo') {
        steps {
            git url: 'https://github.com/terraform-providers/terraform-provider-google.git'
        }
    }

    stage('Terraform Init') { 
      steps {
        dir  ('examples/two-tier') {
            sh 'terraform init' 
        }
      }
    }
    
    stage('Terraform Plan') { 
      steps {
        dir  ('examples/two-tier') {
            sh 'ls -la && pwd'
            sh 'terraform plan -no-color -out=create.tfplan' 
        }
      }
    }


    stage ('Terraform Apply') {
     steps{
      sh "terraform --version"
     }
    }
  }
}